# Copyright 2024 Canonical Ltd.
# See LICENSE file for licensing details.

bundle: kubernetes
name: identity-platform
description: |
  The Canonical Identity Platform is a composable identity broker and identity provider based on open source products.
docs: https://discourse.charmhub.io/t/canonical-identity-platform/11825
website: https://github.com/canonical/iam-bundle
issues: https://github.com/canonical/iam-bundle/issues
applications:
  hydra:
    charm: hydra
    revision: 339
    resources:
      oci-image: ghcr.io/canonical/hydra:2.3.0-canonical
    channel: edge
    scale: 1
    series: jammy
    trust: true
  kratos:
    charm: kratos
    revision: 500
    resources:
      oci-image: ghcr.io/canonical/kratos:1.3.1
    channel: edge
    scale: 1
    series: jammy
    trust: true
  kratos-external-idp-integrator:
    charm: kratos-external-idp-integrator
    channel: edge
    revision: 245
    scale: 1
    series: jammy
  identity-platform-login-ui-operator:
    charm: identity-platform-login-ui-operator
    revision: 146
    resources:
      oci-image: ghcr.io/canonical/identity-platform-login-ui:v0.21.2
    channel: edge
    scale: 1
    series: jammy
    trust: true
  postgresql-k8s:
    charm: postgresql-k8s
    channel: 14/stable
    series: jammy
    scale: 1
    trust: true
    options:
      plugin_pg_trgm_enable: true
      plugin_btree_gin_enable: true
  self-signed-certificates:
    charm: self-signed-certificates
    channel: latest/stable
    scale: 1
  traefik-admin:
    charm: traefik-k8s
    channel: latest/stable
    revision: 176
    scale: 1
    trust: true
  traefik-public:
    charm: traefik-k8s
    channel: latest/stable
    revision: 176
    scale: 1
    trust: true
relations:
  - [hydra:pg-database, postgresql-k8s:database]
  - [kratos:pg-database, postgresql-k8s:database]
  - [kratos:hydra-endpoint-info, hydra:hydra-endpoint-info]
  - [kratos-external-idp-integrator:kratos-external-idp, kratos:kratos-external-idp]
  - [hydra:admin-ingress, traefik-admin:ingress]
  - [hydra:public-ingress, traefik-public:ingress]
  - [kratos:admin-ingress, traefik-admin:ingress]
  - [kratos:public-ingress, traefik-public:ingress]
  - [identity-platform-login-ui-operator:ingress, traefik-public:ingress]
  - [identity-platform-login-ui-operator:hydra-endpoint-info, hydra:hydra-endpoint-info]
  - [identity-platform-login-ui-operator:ui-endpoint-info, hydra:ui-endpoint-info]
  - [identity-platform-login-ui-operator:ui-endpoint-info, kratos:ui-endpoint-info]
  - [identity-platform-login-ui-operator:kratos-info, kratos:kratos-info]
  - [traefik-admin:certificates, self-signed-certificates:certificates]
  - [traefik-public:certificates, self-signed-certificates:certificates]