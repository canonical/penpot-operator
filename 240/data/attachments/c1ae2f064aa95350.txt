[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHServer received from the controller
[32mINFO    [0m pytest_operator.plugin:plugin.py:806 Connecting to existing model github-pr-b9896-microk8s:testing on unspecified cloud
[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHServer received from the controller
[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHSession received from the controller
[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHTunneler received from the controller
[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHServer received from the controller
[33mWARNING [0m juju.client.connection:connection.py:927 unexpected facade SSHServer received from the controller
[32mINFO    [0m juju.model:model.py:2098 Deploying ch:amd64/focal/minio-383
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  minio/0 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  minio/0 [idle] active: 
[32mINFO    [0m integration.conftest:conftest.py:135 waiting for mailcatcher pod
[32mINFO    [0m integration.conftest:conftest.py:135 waiting for mailcatcher pod
[32mINFO    [0m integration.conftest:conftest.py:135 waiting for mailcatcher pod
[32mINFO    [0m integration.conftest:conftest.py:135 waiting for mailcatcher pod
[32mINFO    [0m integration.conftest:conftest.py:135 waiting for mailcatcher pod
[32mINFO    [0m integration.conftest:conftest.py:131 mailcatcher running at 10.1.243.141
[32mINFO    [0m oauth_tools.fixtures:fixtures.py:32 Deploying dex resources
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex "HTTP/1.1 404 Not Found"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 404 Not Found"
[32mINFO    [0m oauth_tools.external_idp:external_idp.py:121 No service found for identity provider
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/apps/v1/namespaces/dex/deployments/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/configmaps/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/serviceaccounts/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/rbac.authorization.k8s.io/v1/clusterroles/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings/dex?force=true&fieldManager=dex-test "HTTP/1.1 201 Created"
[32mINFO    [0m oauth_tools.external_idp:external_idp.py:152 Restarting dex
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: DELETE https://10.1.0.131:16443/api/v1/namespaces/dex/pods/dex-db86d8ddb-h5cfw "HTTP/1.1 200 OK"
[32mINFO    [0m oauth_tools.external_idp:external_idp.py:155 Waiting for dex to be ready
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?fieldSelector=metadata.name%3Ddex-db86d8ddb-lgwqb&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/apis/apps/v1/namespaces/dex/deployments?fieldSelector=metadata.name%3Ddex&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 200 OK"
[32mINFO    [0m oauth_tools.oauth_helpers:oauth_helpers.py:71 Configuring the identity platform
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 200 OK"
[32mINFO    [0m oauth_tools.oauth_helpers:oauth_helpers.py:80 Waiting for the identity platform to deploy
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [allocating] waiting: installing agent
  traefik-public/0 [allocating] waiting: installing agent
  hydra/0 [allocating] waiting: installing agent
  kratos/0 [allocating] waiting: installing agent
  kratos-external-idp-integrator/0 [allocating] waiting: installing agent
  identity-platform-login-ui-operator/0 [allocating] waiting: installing agent
  self-signed-certificates/0 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [allocating] waiting: installing agent
  traefik-public/0 [allocating] waiting: installing agent
  hydra/0 [executing] blocked: Missing required relation with public-ingress
  kratos/0 [allocating] waiting: installing agent
  kratos-external-idp-integrator/0 [allocating] waiting: installing agent
  identity-platform-login-ui-operator/0 [executing] maintenance: installing charm software
  self-signed-certificates/0 [allocating] waiting: installing agent
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [allocating] waiting: installing agent
  traefik-public/0 [allocating] waiting: installing agent
  hydra/0 [idle] blocked: Missing required relation with public-ingress
  kratos/0 [executing] maintenance: installing charm software
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
  identity-platform-login-ui-operator/0 [idle] active: 
  self-signed-certificates/0 [executing] maintenance: installing charm software
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [executing] active: 
  traefik-public/0 [executing] maintenance: installing charm software
  hydra/0 [executing] blocked: Missing required relation with public-ingress
  kratos/0 [idle] maintenance: installing charm software
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
  identity-platform-login-ui-operator/0 [idle] active: 
  self-signed-certificates/0 [executing] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [executing] active: 
  traefik-public/0 [executing] maintenance: updating ingress configuration for 'ingress:15'
  hydra/0 [idle] waiting: Waiting for database creation
  kratos/0 [executing] waiting: Waiting for database creation
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
  identity-platform-login-ui-operator/0 [idle] active: 
  self-signed-certificates/0 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  traefik-admin/0 [idle] active: 
  traefik-public/0 [executing] maintenance: updating ingress configuration for 'ingress:16'
  hydra/0 [idle] waiting: Waiting for database creation
  kratos/0 [executing] waiting: Waiting for database creation
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
  identity-platform-login-ui-operator/0 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  hydra/0 [idle] active: 
  kratos/0 [executing] waiting: Waiting for configuration to be updated
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  kratos/0 [executing] waiting: Waiting for configuration to be updated
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  kratos/0 [executing] waiting: Waiting for configuration to be updated
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  kratos/0 [executing] maintenance: Configuring resources
  kratos-external-idp-integrator/0 [idle] waiting: Waiting for Kratos to register provider
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  kratos/0 [idle] active: 
  kratos-external-idp-integrator/0 [idle] active: Provider is ready
[32mINFO    [0m oauth_tools.oauth_helpers:oauth_helpers.py:87 Successfully deployed the identity platform
[32mINFO    [0m oauth_tools.oauth_helpers:oauth_helpers.py:98 Configuring the external provider
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/apps/v1/namespaces/dex/deployments/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/configmaps/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/api/v1/namespaces/dex/serviceaccounts/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/rbac.authorization.k8s.io/v1/clusterroles/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: PATCH https://10.1.0.131:16443/apis/rbac.authorization.k8s.io/v1/clusterrolebindings/dex?force=true&fieldManager=dex-test "HTTP/1.1 200 OK"
[32mINFO    [0m oauth_tools.external_idp:external_idp.py:152 Restarting dex
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: DELETE https://10.1.0.131:16443/api/v1/namespaces/dex/pods/dex-db86d8ddb-lgwqb "HTTP/1.1 200 OK"
[32mINFO    [0m oauth_tools.external_idp:external_idp.py:155 Waiting for dex to be ready
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?fieldSelector=metadata.name%3Ddex-db86d8ddb-8c6m6&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/apis/apps/v1/namespaces/dex/deployments?fieldSelector=metadata.name%3Ddex&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?labelSelector=app%3Ddex "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/pods?fieldSelector=metadata.name%3Ddex-db86d8ddb-8c6m6&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/apis/apps/v1/namespaces/dex/deployments?fieldSelector=metadata.name%3Ddex&watch=true "HTTP/1.1 200 OK"
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET https://10.1.0.131:16443/api/v1/namespaces/dex/services/dex "HTTP/1.1 200 OK"
[32mINFO    [0m integration.test_charm:test_charm.py:118 deploying penpot charm
[32mINFO    [0m juju.model:model.py:2098 Deploying local:penpot-0
[32mINFO    [0m juju.model:model.py:2098 Deploying ch:amd64/jammy/redis-k8s-42
[32mINFO    [0m juju.model:model.py:2098 Deploying ch:amd64/jammy/smtp-integrator-93
[32mINFO    [0m juju.model:model.py:2098 Deploying ch:amd64/jammy/s3-integrator-145
[32mINFO    [0m juju.model:model.py:2098 Deploying ch:amd64/focal/nginx-ingress-integrator-109
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  s3-integrator/0 [allocating] waiting: installing agent
  self-signed-certificates/0 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  s3-integrator/0 [allocating] waiting: installing agent
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[33mWARNING [0m juju.model:model.py:1564 relate is deprecated and will be removed. Use integrate instead.
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  minio/0 [idle] active: 
  hydra/0 [idle] active: 
  identity-platform-login-ui-operator/0 [idle] active: 
  kratos/0 [idle] active: 
  kratos-external-idp-integrator/0 [idle] active: Provider is ready
  postgresql-k8s/0 [executing] active: Primary
  self-signed-certificates/0 [executing] active: 
  traefik-admin/0 [idle] active: 
  traefik-public/0 [idle] active: 
  penpot/0 [executing] blocked: waiting for ingress, postgresql, redis, s3
  penpot/1 [executing] blocked: waiting for ingress, postgresql, redis, s3
  redis-k8s/0 [executing] active: 
  smtp-integrator/0 [executing] active: 
  s3-integrator/0 [idle] active: 
  nginx-ingress-integrator/0 [executing] waiting: Waiting for nginx-route/ingress relation
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  postgresql-k8s/0 [idle] active: Primary
  penpot/0 [idle] blocked: waiting for ingress
  penpot/1 [idle] blocked: waiting for ingress
  nginx-ingress-integrator/0 [executing] waiting: Waiting for ingress IP availability
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  penpot/0 [executing] waiting: waiting for penpot services
  penpot/1 [executing] waiting: waiting for penpot services
  nginx-ingress-integrator/0 [executing] active: Ingress IP(s): 127.0.0.1
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  penpot/0 [executing] waiting: waiting for penpot services
  penpot/1 [executing] waiting: waiting for penpot services
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  penpot/0 [executing] waiting: waiting for penpot services
  penpot/1 [idle] active: 
[32mINFO    [0m juju.model:model.py:2972 Waiting for model:
  kratos/0 [idle] active: 
[32mINFO    [0m integration.test_charm:test_charm.py:160 test user account: (admin@example.com, password)